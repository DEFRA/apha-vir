@model EditSubmissionDetailsViewModel

<style>

	.editsubmission-contentbox {
		border-top: #0b2677 1px solid;
		border-right: #0b2677 1px solid;
		border-bottom: #0b2677 1px solid;
		border-left: #0b2677 1px solid;
		margin: 0px 0px 15px 0px;
	}

	.editsubmission-box_title {
		padding-top: 3px;
		padding-right: 10px;
		padding-bottom: 3px;
		padding-left: 10px;
		/* padding: 0.2em 1px 2px 14px; */
		background-color: #0b2677;
		color: #ffffff;
		/* font-size: 0.9em; */
		font-weight: bold;
	}

	.editsubmission-box_body {
		padding-top: 0px;
		padding-right: 10px;
		padding-bottom: 10px;
		padding-left: 10px;
	}

	.editsubmission-form-group_row {
		margin-top: 1
	}

	.editsubmission-body_title {
		background-color: #ffffff;
		color: #333333;
		font-family: verdana, arial, helvetica, sans-serif;
		font-size: small;
		margin: 0;
		padding: 0;
		text-align: left;
		font-weight: bold
	}

	.editsubmission-btn-link-custom {
		background: none;
		border: none;
		font-family: verdana, arial, helvetica, sans-serif;
		color: #0000FF;
		text-decoration: underline;
		cursor: pointer;
	}

	/* Basic fade effect */
	.modal {
		display: none;
		position: fixed;
		top: 0;
		left: 0;
		z-index: 1050;
		width: 100%;
		height: 100%;
		overflow: hidden;
		outline: 0;
		background-color: rgba(0, 0, 0, 0.5); /* dim background */
	}

		.modal.show {
			display: block;
		}

	.modal-dialog {
		position: relative;
		width: auto;
		margin: 1.75rem auto;
		max-width: 600px; /* adjust modal width */
	}

	.modal-content {
		position: relative;
		/*display: flex;*/
		flex-direction: column;
		background-color: lightcyan;
		/*border-style: groove;
		border-color: rgb(224, 224, 224);
		background-clip: padding-box;
		border: 1px solid rgba(0, 0, 0, 0.2);
			border-radius: .3rem;
			outline: 0;*/
		/*box-shadow: 0 3px 9px rgba(0,0,0,.5);*/
	}



	.modal-header,
	.modal-footer {
		display: flex;
		align-items: center;
		justify-content: space-between;
		padding: .75rem 1rem;
		border-bottom: 1px solid #dee2e6;
	}

	.modal-footer {
		border-top: 1px solid #dee2e6;
	}

	.modal-title {
		margin-bottom: 0;
		line-height: 1.5;
	}

	.modal-body {
		position: relative;
		flex: 1 1 auto;
		padding: 1rem;
	}

	/* Close button */
	.btn-close {
		padding: .25rem .25rem;
		background: transparent url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath d='M.293.293a1 1 0 011.414 0L8 6.586l6.293-6.293a1 1 0 111.414 1.414L9.414 8l6.293 6.293a1 1 0 01-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 01-1.414-1.414L6.586 8 .293 1.707a1 1 0 010-1.414z'/%3e%3c/svg%3e") center/1em auto no-repeat;
		border: 0;
		opacity: .5;
	}

		.btn-close:hover {
			opacity: .75;
		}

	.custom-modal {
		background-color: lightcyan;
		border-color: rgb(224, 224, 224);
		border-style: groove;
		width: 552px;
		position: fixed;
		z-index: 100001;
		left: 91px;
		top: 183px;
		display: none; /* Bootstrap JS will override to block when shown */
	}

	.control-width-normal {
		width:226px;
	}

	.control-width-large {
		width: 377.95px;
	}

	.legend{
		color: #15417e;
	}

	/* Rows behave like table rows */
	.editsubmission-form-group_row {
		display: table-row;
	}

	/* Cells behave like table cells */
	.editsubmission-addsender-cell {
		display: table-cell;
		border: 1px solid #000;
		padding: 6px 8px;
		vertical-align: middle;
	}

	/* Label column */
	.editsubmission-addsender-label {
		width: 100px; 
		font-weight: normal;

	}

	/* Input column */
	.editsubmission-addsender-input {
		width: 350px; 
	}

		/* Make all input controls uniform */
		.editsubmission-addsender-input input,
		.editsubmission-addsender-input textarea,
		.editsubmission-addsender-input select {
			width: 100%;
			height: 32px; /* same height across all controls */
			padding: 4px 6px;
			box-sizing: border-box;
			border: 1px solid #ccc;
			font-size: 14px;
			font-family: inherit;
		}

		/* Special case for textarea (so it doesn’t expand too tall) */
		.editsubmission-addsender-input textarea {
			resize: none;
			height: 60px; 
		}

		/* Validation message */
		.editsubmission-addsender-input .text-danger {
			font-weight: bold;
			color: red;
			display: block;
			margin-top: 2px;
			font-size: 12px;
		}



</style>

<div id="contentbox" class="editsubmission-contentbox">
	<div class="editsubmission-box_title">Enter/Update the Submission details.</div>
	<div class="editsubmission-box_body">

		<div class="editsubmission-body_title  mt-3">Enter Submission details.</div>
		<form asp-action="Details" asp-controller="Submission" method="post">
			<div class="submission-form">
				<div class="row mt-4">
					<label class="col-form-label col-sm-3">AV Number</label>
					<div class="col-sm-9">
						<input asp-for="AVNumber" class="control-width-normal" readonly />
					</div>
				</div>
				<div class="row mt-3">
					<label class="col-form-label col-sm-3">
						RL Reference Number<br /><small>(UK Diagnostic Submissions Only)</small>
					</label>
					<div class="col-sm-9">
						<input asp-for="RLReferenceNumber" class="control-width-normal" />
					</div>
				</div>
				<div class="row mt-3">
					<label class="col-form-label col-sm-3">
						Submitting Lab<br /><small>(UK Diagnostic Submissions Only)</small>
					</label>
					<div class="col-sm-9">
						<select asp-for="SubmittingLab" asp-items="Model.SubmittingLabList" class="control-width-normal"></select>
					</div>
				</div>
				<div class="row mt-3">
					<label class="col-form-label col-sm-3">Sender's Submission Reference Number</label>
					<div class="col-sm-9">
						<input asp-for="SendersReferenceNumber" class="control-width-normal" />
						<span asp-validation-for="SendersReferenceNumber" class="text-danger"></span>
					</div>
				</div>
				<div class="row mt-3">
					<label class="col-form-label col-sm-3">Submitting Country</label>
					<div class="col-sm-9">
						<select asp-for="SubmittingCountry" asp-items="Model.CountryList" class="control-width-normal"></select>
					</div>
				</div>
				<div class="row mt-3">
					<label class="col-form-label col-sm-3">Sender</label>
					<div class="col-sm-9">
						<input asp-for="Sender" class="control-width-large" maxlength="50" />
                        <button type="button" class="btn btn-link editsubmission-btn-link-custom" onclick="openPopupSender()" id="mainSendersBtn">Main Senders</button>
						<button type="button" class="btn btn-link  editsubmission-btn-link-custom" onclick="openPopupAddSender()" id="addSenderBtn">Add</button>
					</div>
				</div>
				<div class="row mt-3">
					<label class="col-form-label col-sm-3">Sender Organisation</label>
					<div class="col-sm-9">
						<textarea asp-for="SenderOrganisation" class="control-width-large" maxlength="200"></textarea>
						<button type="button" class="btn btn-link  editsubmission-btn-link-custom" onclick="openPopupOrganisation()" id="mainOrgsBtn">Main Organisations</button>
					</div>
				<div class="row mt-3">
					<label class="col-form-label col-sm-3">Sender Address</label>
					<div class="col-sm-9">
						<textarea asp-for="SenderAddress" class="control-width-large" style="height:96px" maxlength="500"></textarea>
					</div>
				</div>
				<div class="row mt-3">
					<label class="col-form-label col-sm-3">Country of Origin</label>
					<div class="col-sm-9">
						<select asp-for="CountryOfOrigin" asp-items="Model.CountryList" class="control-width-normal"></select>
					</div>
				</div>
				<div class="row mt-3">
					<label class="col-form-label col-sm-3">Reason for Submission</label>
					<div class="col-sm-9">
						<select asp-for="ReasonForSubmission" asp-items="Model.ReasonList" class="control-width-normal"></select>
					</div>
				</div>
				<div class="row mt-3">
					<label class="col-form-label col-sm-3">Date Submission Received</label>
					<div class="col-sm-9">
						<input asp-for="DateSubmissionReceived" style="width:113.39" type="date" />
						<span asp-validation-for="DateSubmissionReceived" class="text-danger"></span>
					</div>
				</div>

				<div class="row mt-3">
					<label class="col-form-label col-sm-3">No. Samples Received</label>
					<div class="col-sm-9">
						<input asp-for="NumberOfSamples" class="control-width-normal" type="number" min="1" />
						<span asp-validation-for="NumberOfSamples" class="text-danger"></span>
					</div>
				</div>
				<div class="row mt-3">
					<label class="col-form-label col-sm-3">CPH Number</label>
					<div class="col-sm-9">
						<input asp-for="CPHNumber" class="control-width-normal" />
						<span asp-validation-for="CPHNumber" class="text-danger"></span>
					</div>
				</div>
				<div class="row mt-3">
					<label class="col-form-label col-sm-3">Owner</label>
					<div class="col-sm-9">
						<input asp-for="Owner" class="form-control" />
					</div>
				</div>
				<div class="row mt-3">
					<label class="col-form-label col-sm-3">Sampling Location / Premises</label>
					<div class="col-sm-9">
						<input asp-for="SamplingLocationPremises" class="form-control" />
					</div>
				</div>
				<div class="row mt-3">
					<div class="col-sm-12 text-right">
						<button type="submit" style="margin-left:725px" class="btn btn-link editsubmission-btn-link-custom">Update</button>
						<a asp-action="Index" class="btn btn-link editsubmission-btn-link-custom">Cancel</a>
					</div>
				</div>
			</div>
		</form>
	</div>
</div>
<div class="modal fade" id="popupModal" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content" id="popupModalContent">
			<!-- Partial will load here -->
		</div>
	</div>
</div>



@section Scripts {
	<partial name="_ValidationScriptsPartial" />
	<script>
		function openPopupSender() {

			$.get('@Url.Action("PopupSender", "Submission")', function (data) {
				$('#popupModalContent').html(data);

				var popup = new bootstrap.Modal(document.getElementById('popupModal'));
				popup.show();

				$('#popupModal').on('shown.bs.modal', function () {
					$(this).find('select, input, button').first().trigger('focus');
				});
			});
		}

		function openPopupOrganisation() {

			$.get('@Url.Action("PopupOrganisation", "Submission")', function (data) {
				$('#popupModalContent').html(data);

				var popup = new bootstrap.Modal(document.getElementById('popupModal'));
				popup.show();

				$('#popupModal').on('shown.bs.modal', function () {
					$(this).find('select, input, button').first().trigger('focus');
				});
			});
		}

		function openPopupAddSender() {
			$.get("/Submission/AddSender", function (data) {
				$("#popupModalContent").html(data);

				$("#popupModal .modal-dialog").css("max-width", "482px");

				// Re-parse validation for dynamically added form
				$.validator.unobtrusive.parse("#senderForm");

				$("#popupModal").modal("show");
			});
		}

		function closePopup() {
			$("#popupModal").modal("hide");
		}

		function submitSender() {
			var form = $("#senderForm");
			if (!form.valid()) {
				return;
			}
			var formData = form.serialize();
			$.post("/Submission/SaveSender", formData, function (response) {
				if (response.success) {
					alert(response.message);
					closePopup();
				} else {
					alert(response.message);
				}
			});
		}
	</script>
}


				