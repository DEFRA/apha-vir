@model SubmissionViewModel
@{
	ViewData["Title"] = "Submission, Samples & Isolates | Virus Isolates Repository";
}

<style>

</style>

<span style="font-weight:bold">
	@Model.AVNumber
</span>
<nav>
	<ul class="linklist" style="list-style: none; padding-left: 0;">
		<nav>
			<ul class="linklist" style="list-style: none; padding-left: 0;">
				<li>
					<img src="~/Images/chevron-rt-dkblue.gif" width="3" height="9" alt="">
					<img src="~/Images/spacer.gif" width="3" height="9" alt="">
					<a asp-action="EditSubmission" asp-route-id="@Model.Id">Edit this Submission</a>
				</li>
				<li>
					<img src="~/Images/chevron-rt-dkblue.gif" width="3" height="9" alt="">
					<img src="~/Images/spacer.gif" width="3" height="9" alt="">
					<a asp-action="AddSample" asp-route-submissionId="@Model.Id">Add a new Sample</a>
				</li>
				@if (Model.ShowLetterLink)
				{
					<li>
						<img src="~/Images/chevron-rt-dkblue.gif" width="3" height="9" alt="">
						<img src="~/Images/spacer.gif" width="3" height="9" alt="">
						<a asp-action="GenerateMissingDetailsLetter" asp-route-id="@Model.Id">Missing Details Letter</a>
						@if (Model.IsLetterRequired)
						{
							<span class="text-danger">Required</span>
						}
					</li>
				}
				@if (Model.ShowDeleteLink)
				{
					<li>
						<img src="~/Images/chevron-rt-dkblue.gif" width="3" height="9" alt="">
						<img src="~/Images/spacer.gif" width="3" height="9" alt="">
						<a asp-action="DeleteSubmission" asp-route-id="@Model.Id" data-confirm="Are you sure you want to Delete this submission?">Delete this Submission</a>
					</li>
				}
				<li>
					<img src="~/Images/chevron-rt-dkblue.gif" width="3" height="9" alt="">
					<img src="~/Images/spacer.gif" width="3" height="9" alt="">
					<a asp-action="FinishEditing" asp-route-id="@Model.Id">Finish editing this Submission</a>
				</li>
			</ul>
		</nav>
	</ul>
</nav>

@if (!string.IsNullOrEmpty(Model.SubmissionValidationMessage))
{
	<div class="validation-message">@Model.SubmissionValidationMessage</div>
}

@if (!string.IsNullOrEmpty(Model.WarnSMSubmissionMessage))
{
	<div class="validation-message">@Model.WarnSMSubmissionMessage</div>
}
<div class="submission-grid-table mt-1">
	<h3 class="submission-h3">Submission Summary</h3>
	<br />
	<table class="table">
		<thead>
			<tr>
				<th>Submission Sender Ref</th>
				<th>Sender Organisation</th>
				<th>Country Of Origin</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>@Model.SendersReferenceNumber</td>
				<td>@Model.SenderOrganisation</td>
				<td>@Model.CountryOfOriginName</td>
			</tr>
		</tbody>
	</table>
	<br />
	<h3 class="submission-h3">Samples for this submission</h3>
	<br />
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Sample Number</th>
				<th>SMS Ref</th>
				<th>Sample Sender Ref</th>
				<th>Group</th>
				<th>Species</th>
				<th colspan="3">Actions</th>
			</tr>
		</thead>
		<tbody>
			@foreach (var sample in Model.Samples)
			{
				<tr>
					<td>@sample.SampleNumber</td>
					<td>@sample.SMSReferenceNumber</td>
					<td>@sample.SenderReferenceNumber</td>
					<td>@sample.HostSpeciesName</td>
					<td>@sample.HostBreedName</td>
					<td><a asp-action="EditSample" asp-route-id="@sample.Id">Edit</a></td>
					<td><a asp-action="DeleteSample" asp-route-id="@sample.Id" data-confirm="Are you sure that you want to delete this Sample?">Delete</a></td>
					<td><a asp-action="AddIsolate" asp-route-sampleId="@sample.Id">Add Isolate</a></td>
				</tr>
			}
		</tbody>
	</table>
	<br />
	@if (!string.IsNullOrEmpty(Model.SampleValidationMessage))
	{
		<div class="validation-message">@Model.SampleValidationMessage</div>
	}

	<h3 class="submission-h3">@Model.IsolatesHeader</h3>
	<br />
	<table class="table table-striped">
		<thead>
			<tr>
				<th>Sample Number</th>
				<th>SMS Ref</th>
				<th>Sample Sender Ref</th>
				<th>Virus Type</th>
				<th>Year Of Isolation</th>
				<th>Characteristics</th>
				<th>Nomenclature</th>
				<th colspan="3"></th>
			</tr>
		</thead>
		<tbody>
			@foreach (var isolate in Model.Isolates)
			{
				<tr>
					<td>@isolate.SampleNumber</td>
					<td>@isolate.SMSReferenceNumber</td>
					<td>@isolate.SenderReferenceNumber</td>
					<td>@isolate.TypeName</td>
					<td>@isolate.YearOfIsolation</td>
					<td>@isolate.Characteristics</td>
                    <td>
                        @if (isolate.isUniqueNomenclature)
                        {
                            <span style="font-weight:bold; color:green;">Unique</span>
                        }
                        else
                        {
                            <span style="font-weight:bold; color:red;">Not Unique</span>
                        }
                    </td>
					<td><a asp-action="EditIsolate" asp-route-id="@isolate.Id">Edit</a></td>
					<td><a asp-action="DeleteIsolate" asp-route-id="@isolate.Id" data-confirm="Are you sure that you want to delete this Isolate?">Delete</a></td>
					<td><a asp-action="DispatchIsolate" asp-route-id="@isolate.Id">Dispatch</a></td>
				</tr>
			}
		</tbody>
	</table>
	<br />
</div>
@if (!string.IsNullOrEmpty(Model.IsolateValidationMessage))
{
	<div class="validation-message">@Model.IsolateValidationMessage</div>
}

@section Scripts {
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			document.querySelectorAll('[data-confirm]').forEach(function (element) {
				element.addEventListener('click', function (e) {
					if (!confirm(this.getAttribute('data-confirm'))) {
						e.preventDefault();
					}
				});
			});
		});
	</script>
}